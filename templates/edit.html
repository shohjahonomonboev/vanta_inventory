{% extends "base.html" %}
{% block title %}Edit Item &mdash; Jasurbek{% endblock %}

{% block content %}
<h1>Edit Item &#x1F6E0;&#xFE0F;</h1>
<p class="subtitle">Vanta Inventory System</p>

<form method="POST" class="form-col">
  <!-- item tuple: [0]=id, [1]=name, [2]=buy, [3]=sell, [4]=quantity, ... -->
  <input type="text" name="name" placeholder="Item Name" value="{{ item[1] }}" required>

  <!-- Show prices in current UI currency; converted back to UZS on save -->
  <input
    type="text"
    name="buying_price"
    data-money
    data-decimals="0"
    placeholder="Buying Price ({{ CURRENCY }})"
    value="{{ (item[2] | ccy) | money }}"
    required>

  <input
    type="text"
    name="selling_price"
    data-money
    data-decimals="0"
    placeholder="Selling Price ({{ CURRENCY }})"
    value="{{ (item[3] | ccy) | money }}"
    required>

  <input type="number" name="quantity" placeholder="Quantity" value="{{ item[4] }}" min="0" required>

  <button type="submit">Update</button>
  <a href="{{ url_for('index') }}" class="btn btn-light" style="margin-left:.5rem">Cancel</a>
</form>

<!-- Live input money formatter (same as index.html) -->
<script>
(function () {
  const inputs = document.querySelectorAll("[data-money]");
  function formatMoney(raw){ const d=String(raw||"").replace(/[^\d]/g,""); return d?d.replace(/\B(?=(\d{3})+(?!\d))/g,","):""; }
  function unformatMoney(s){ return String(s||"").replace(/,/g,""); }
  inputs.forEach(inp=>{
    if(inp.value) inp.value = formatMoney(inp.value);
    inp.addEventListener("input", ()=>{
      const start = inp.selectionStart||0, before = inp.value;
      inp.value = formatMoney(before);
      const diff = inp.value.length - before.length;
      const pos = Math.max(0, start + diff);
      try{ inp.setSelectionRange(pos,pos); }catch(e){}
    });
    inp.addEventListener("blur", ()=>{ inp.value = formatMoney(inp.value); });
    if(inp.form){
      inp.form.addEventListener("submit", ()=>{ inp.value = unformatMoney(inp.value); });
    }
  });
})();
</script>
{% endblock %}



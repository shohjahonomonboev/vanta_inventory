{% extends "base.html" %}
{% block title %}Edit Item — Jasurbek{% endblock %}
{% block content %}
<h1>Edit Item 🛠️</h1>
<p class="subtitle">Vanta Inventory System</p>

<form method="POST" class="form-col">
  <input type="text" name="name" placeholder="Item Name" value="{{ item['name'] }}" required>

  <!-- Show prices in current UI currency; they’ll be converted back to UZS on save -->
  <input type="text" name="buying_price" data-money data-decimals="0"
         placeholder="Buying Price ({{ CURRENCY }})"
         value="{{ (item['buying_price'] | ccy) | money }}"
         required>

  <input type="text" name="selling_price" data-money data-decimals="0"
         placeholder="Selling Price ({{ CURRENCY }})"
         value="{{ (item['selling_price'] | ccy) | money }}"
         required>

  <input type="number" name="quantity" placeholder="Quantity" value="{{ item['quantity'] }}" required>
  <button type="submit">Update</button>
</form>

<!-- Live input money formatter (same as index.html) -->
<script>
(function () {
  const inputs = document.querySelectorAll("[data-money]");
  function formatMoney(raw){ const d=String(raw||"").replace(/[^\d]/g,""); return d?d.replace(/\B(?=(\d{3})+(?!\d))/g,","):""; }
  function unformatMoney(s){ return String(s||"").replace(/,/g,""); }
  inputs.forEach(inp=>{
    if(inp.value) inp.value = formatMoney(inp.value);
    inp.addEventListener("input", ()=>{
      const start = inp.selectionStart||0, before = inp.value;
      inp.value = formatMoney(before);
      const diff = inp.value.length - before.length;
      const pos = Math.max(0, start + diff);
      try{ inp.setSelectionRange(pos,pos); }catch(e){}
    });
    inp.addEventListener("blur", ()=>{ inp.value = formatMoney(inp.value); });
    if(inp.form){
      inp.form.addEventListener("submit", ()=>{ inp.value = unformatMoney(inp.value); });
    }
  });
})();
</script>
{% endblock %}
